# TypingSite服务端文档-协议接口

[TOC]

## [*数据库设计*](#)

## 接口实现表
>*斜体*表示**暂不实现**或**待修正**的**非确定接口**

+ 方案操作
- [ ] [请求方案列表](#请求方案列表)
- [ ] [请求方案](#请求方案)
- [ ] [添加方案](#添加方案)
+ 文章操作
- [ ] [请求文章列表](#请求文章列表)
- [ ] [请求文章](#请求文章)
- [x] [转换文章](#转换文章)
- [ ] [添加文章](#添加文章)

## 协议接口
### 接口约定
+ 请求体标为None表示不需要请求体
+ 响应体标为None表示响应体为空对象
+ 通用错误响应体约定，每个协议错误时响应体都遵循
+ **error**与**message**必定一起出现
+ 无**error**与**message**时，响应体依照接口说明返回
+ **如无特定说明，接口请求体为application/json，使用相应请求格式请求**

### 通用错误响应体
```json
{
	"error": int,
    "message": "string"
}
```
| 参数名 | 类型 | 可选性 | 描述
|----|----|
| **error** | int | 可选 | 全局错误码，见[状态数据约定](#状态数据约定)，只有接口出错才返回
| **message** | string | 可选 | 错误信息，见[状态数据约定](#状态数据约定)，只有接口出错才返回


### 方案操作
#### 请求方案列表
*该接口尚未实现*
> 接口说明：
> 获取现有方案列表。

+ 接口地址:`/api/scheme/list`
+ 请求方法: GET
+ 请求体: None
+ 响应体: None
+ 可能的错误码: None


#### 请求方案
*该接口尚未实现*
> 接口说明：
> 获取名称为**name**的方案数据。

+ 接口地址:`/api/scheme/<name>`
| 参数名 | 类型 | 可选性 | 描述
|----|----|
| **name** | string | 必选 | 方案名，见[方案名称约定](#方案名称约定)


+ 请求方法: GET
+ 请求体: None
+ 响应体: None
+ 可能的错误码:
`100`[缺少需要的请求参数，或参数格式与约定或预期的格式不符](#状态数据约定)
`101`[请求的方案不存在](#状态数据约定)


#### 添加方案
*该接口尚未实现*
*限管理员调用*
> 接口说明：
> 添加组织好的方案数据到方案列表中。

+ 接口地址:`/api/scheme/add`
+ 请求方法: POST
+ 请求体: None
+ 响应体: None
+ 可能的错误码:
`100`[缺少需要的请求参数，或参数格式与约定或预期的格式不符](#状态数据约定)


### 文章操作
#### 请求文章列表
*该接口尚未实现*
> 接口说明：
> 获取现有文章列表。

+ 接口地址:`/api/article/list`
+ 请求方法: GET
+ 请求体: None
+ 响应体: None
+ 可能的错误码: None


#### 请求文章
*该接口尚未实现*
> 接口说明：
> 获取id为**id**的文章数据。

+ 接口地址:`/api/article/<id>`
| 参数名 | 类型 | 可选性 | 描述
|----|----|
| **id** | string | 必选 | 文章id，见[文章id约定](#文章id约定)


+ 请求方法: POST
+ 请求体: None
+ 响应体: None
+ 可能的错误码:
`100`[缺少需要的请求参数，或参数格式与约定或预期的格式不符](#状态数据约定)
`102`[请求的文章不存在](#状态数据约定)


#### 转换文章
> 该接口需要使用**POST**方法，请求体**Content-Type**为**text/plain**，内容为**utf-8**编码文章正文调用。
> 接口说明：
> 将请求的文章内容，转换成经过组织的合法文章数据。

+ 接口地址:`/api/article/convert/<name>`
+ 请求方法: POST
+ 请求体: **utf-8编码的文章全文**
+ 响应体:
```json
{
    "article": [
        {
            "word": "string",
            "tone": ["<initial>", "<final>"],
            "spell": ["<inital>", "<final>"],
            "canInput": true
        }
    ]
}
```
| 参数名 | 类型 | 可选性 | 描述
|----|----|
| **name** | string | 可选 | 方案名称，见[方案名称约定](#方案名称约定)
| **word** | string | 必选 | 字符
| **tone** | list | 可选 | 含音调拼音序列，只有当**canInput**为true时才有
| **tone**.**initial** | string | 可选 | 含音调拼音序列，声母，无声母拼音不存在
| **tone**.**final** | string | 必选 | 含音调拼音序列，韵母
| **spell** | list | 可选 | 纯字母拼音序列，只有当**canInput**为true时才有
| **spell**.**initial** | string | 可选 | 纯字母拼音序列，声母，无声母拼音不存在
| **spell**.**final** | string | 必选 | 纯字母拼音序列，韵母
| **canInput** | bool | 必选 | 是否能够输入，为true则表示该字符为有效汉字，否则为英文数字等符号


+ 可能的错误码:
`100`[缺少需要的请求参数，或参数格式与约定或预期的格式不符](#状态数据约定)


#### 添加文章
*该接口尚未实现*
*限管理员调用*
> 接口说明：
> 添加组织好的部分文章数据到文章列表中。

+ 接口地址:`/api/article/add`
+ 请求方法: POST
+ 请求体: None
+ 响应体: None
+ 可能的错误码:
`100`[缺少需要的请求参数，或参数格式与约定或预期的格式不符](#状态数据约定)


## 数据约定
### 状态数据约定
| 状态码 | 状态描述 | 状态对应**message**
|:----:|----|
| 100 | 缺少需要的请求参数，或参数格式与约定或预期的格式不符 | "缺少参数或参数格式错误！"
| 101 | 请求的方案不存在 | "方案不存在！"
| 102 | 请求的文章不存在 | "文章不存在！"
| 103 | 请求中的文章格式与预期格式不符 | "文章格式错误！"


### 方案名称约定
+ 主流方案数量有限，本地只收录常见的若干种双拼方案（以搜狗拼音内置方案为参考）
+ 方案名称以utf-8编码，名称即id
> + **自然码双拼**
> + **微软双拼**
> + **小鹤双拼**


### 文章id约定
+ 文章id由1到3位纯数字组成，即取值范围[000, 999]
+ 用于匹配文章id的正则约定为`\d{1,3}`
